class Quiz {
    constructor() {
        // Soru veritabanı
        this.questions = [
            {
                level: 1,
                questions: [
                    {
                        id: 1,
                        image: 'images/level-1/resim-1.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj TEMİZ'
                    },
                    {
                        id: 2,
                        image: 'images/level-1/resim-2.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 3,
                        image: 'images/level-1/resim-3.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 4,
                        image: 'images/level-1/resim-4.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 5,
                        image: 'images/level-1/resim-5.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 6,
                        image: 'images/level-1/resim-6.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 7,
                        image: 'images/level-1/resim-7.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 8,
                        image: 'images/level-1/resim-8.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 9,
                        image: 'images/level-1/resim-9.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 10,
                        image: 'images/level-1/resim-10.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 11,
                        image: 'images/level-1/resim-11.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 12,
                        image: 'images/level-1/resim-12.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 13,
                        image: 'images/level-1/resim-13.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 14,
                        image: 'images/level-1/resim-14.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 15,
                        image: 'images/level-1/resim-15.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 16,
                        image: 'images/level-1/resim-16.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 17,
                        image: 'images/level-1/resim-17.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 18,
                        image: 'images/level-1/resim-18.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 19,
                        image: 'images/level-1/resim-19.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 20,
                        image: 'images/level-1/resim-20.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
},
                    ]
                    },
{
        level: 2,
        questions: [
            {
                        id: 1,
                        image: 'images/level-2/resim-1.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj TEMİZ'
                    },
                    {
                        id: 2,
                        image: 'images/level-2/resim-2.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 3,
                        image: 'images/level-2/resim-3.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 4,
                        image: 'images/level-2/resim-4.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 5,
                        image: 'images/level-2/resim-5.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 6,
                        image: 'images/level-2/resim-6.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 7,
                        image: 'images/level-2/resim-7.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 8,
                        image: 'images/level-2/resim-8.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 9,
                        image: 'images/level-2/resim-9.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 10,
                        image: 'images/level-2/resim-10.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 11,
                        image: 'images/level-2/resim-11.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 12,
                        image: 'images/level-2/resim-12.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                   },
{
                        id: 13,
                        image: 'images/level-2/resim-13.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 14,
                        image: 'images/level-2/resim-14.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 15,
                        image: 'images/level-2/resim-15.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 16,
                        image: 'images/level-2/resim-16.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 17,
                        image: 'images/level-2/resim-17.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 18,
                        image: 'images/level-2/resim-18.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 19,
                        image: 'images/level-2/resim-19.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    },
{
                        id: 20,
                        image: 'images/level-2/resim-20.png',
                        options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                        correctOption: 'Bagaj KİRLİ'
                    
                    },
]
    },
{
        level: 3,
        questions: [
            {
                id: 1,
                image: 'images/level-2/resim-1.png',
                options: ['Bagaj KİRLİ', 'Bagaj TEMİZ', 'Tanımsız Alan BULUNMAKTA'],
                correctOption: 'Bagaj KİRLİ'
            },
                    // Diğer soruları buraya ekleyin
                ]
            }
            // Diğer seviyeleri buraya ekleyin
        ];

       // Sabit değerler
        this.totalLevels = 10;
        this.questionsPerLevel = 20;
        this.timePerQuestion = 25;
        this.pointsPerQuestion = 5;
        this.passingScore = 70;
        
        // Durum değişkenleri
        this.currentLevel = 1;
        this.currentQuestion = 0;
        this.score = 0;
        this.timer = null;
        this.timeLeft = this.timePerQuestion;
        this.markerRequired = true;
        this.userAnswers = new Array(this.questionsPerLevel).fill(null);
        
        // Warning overlay ve ses efekti
        this.createWarningOverlay();
        this.warningSound = document.getElementById('warning-sound');
        
        // DOM elementleri
        this.initializeElements();
        
        // Event listeners
        this.initializeEventListeners();
        
        // Başlat
        this.init();
    }
        // Warning overlay elementini oluştur
        this.createWarningOverlay();
        
        // Ses efekti için audio elementi
        this.warningSound = document.getElementById('warning-sound');
    }

    createWarningOverlay() {
        this.warningOverlay = document.createElement('div');
        this.warningOverlay.className = 'warning-overlay';
        document.body.appendChild(this.warningOverlay);
    }

    updateTimer() {
        this.timeElement.textContent = this.timeLeft;
        
        // Son 10 saniye kontrolü
        if (this.timeLeft <= 10) {
            this.timeElement.parentElement.classList.add('warning');
            this.warningOverlay.classList.add('active');
            
            // İlk kez 10 saniyeye girildiğinde ses çal
            if (this.timeLeft === 10) {
                this.playWarningSound();
            }
        } else {
            this.timeElement.parentElement.classList.remove('warning');
            this.warningOverlay.classList.remove('active');
        }
    }

    playWarningSound() {
        if (this.warningSound) {
            this.warningSound.currentTime = 0;
            this.warningSound.play().catch(e => console.log('Ses çalınamadı:', e));
        }
    }

    resetTimer() {
        if (this.timer) {
            clearInterval(this.timer);
        }
        // Timer sıfırlanınca uyarıları kaldır
        this.timeElement.parentElement.classList.remove('warning');
        this.warningOverlay.classList.remove('active');
        this.startTimer();
    }

    handleOptionClick(button) {
        const buttons = this.optionsContainer.querySelectorAll('.option-btn');
        buttons.forEach(btn => {
            btn.classList.remove('selected');
            btn.disabled = false; // Tüm butonları aktif yap
        });
        
        button.classList.add('selected');
        button.disabled = true; // Seçilen butonu devre dışı bırak
        
        const selectedOption = button.textContent;
        
        if (selectedOption === 'Bagaj TEMİZ') {
            this.markerRequired = false;
            this.marker.classList.add('hidden');
        } else {
            this.markerRequired = true;
        }

        this.userAnswers[this.currentQuestion] = {
            option: selectedOption,
            marked: selectedOption === 'Bagaj TEMİZ' ? true : false
        };

        this.updateNavigationButtons();
    }

    showResults() {
        if (this.timer) {
            clearInterval(this.timer);
        }

        // Timer uyarılarını temizle
        this.timeElement.parentElement.classList.remove('warning');
        this.warningOverlay.classList.remove('active');

        this.quizContainer.classList.add('hidden');
        this.resultContainer.classList.remove('hidden');

        const finalScore = this.score;
        const maxScore = this.questionsPerLevel * this.pointsPerQuestion;
        const scorePercentage = (finalScore / maxScore) * 100;

        document.getElementById('result-level').textContent = this.currentLevel;
        document.getElementById('final-score').textContent = `${finalScore} / ${maxScore} (${scorePercentage.toFixed(1)}%)`;

        const passed = this.score >= this.passingScore;
        const passFailText = document.getElementById('pass-fail-text');
        
        if (passed) {
            passFailText.textContent = 'Tebrikler! Seviyeyi başarıyla tamamladınız.';
            passFailText.className = 'result-message success';
        } else {
            passFailText.textContent = 'Üzgünüm, seviyeyi geçemediniz. Tekrar deneyiniz.';
            passFailText.className = 'result-message failure';
        }

        const nextLevelBtn = document.getElementById('next-level-btn');
        const retryBtn = document.getElementById('retry-btn');

        nextLevelBtn.classList.add('hidden');
        retryBtn.classList.add('hidden');

        if (passed && this.currentLevel < this.totalLevels) {
            nextLevelBtn.classList.remove('hidden');
            nextLevelBtn.onclick = () => this.nextLevel();
        } else {
            retryBtn.classList.remove('hidden');
            retryBtn.onclick = () => this.retryLevel();
        }
    }

    cleanup() {
        if (this.timer) {
            clearInterval(this.timer);
        }
        if (this.warningOverlay) {
            this.warningOverlay.remove();
        }
    }
}

// Quiz uygulamasını başlat
document.addEventListener('DOMContentLoaded', () => {
    const quiz = new Quiz();
    
    // Sayfa kapanırken temizlik yap
    window.addEventListener('beforeunload', () => {
        quiz.cleanup();
    });
});